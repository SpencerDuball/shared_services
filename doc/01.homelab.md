# üè† Homelab

This repository will document how my homelab is setup including the hardware used, network configuration, services running, and how it's managed. If you are building a homelab of your own, you should be able to read these docs in order and get a nice homelab setup. When explaining the configuration, I try to capture my thought process and which alternatives were considered and ultimately why I choose the things I choose.

<u>**Goals**</u>

- Ability to host pubically available services (blog, webapps, etc)
- Ability to run LAN services (HomeAssistant, 3D Printer, etc)
- Self host everything on a single Kubernetes cluster

TODO: Provide a high level overview of the network. This should be a diagram similar to the one found on the [Cloudflare Tunnels Docs](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/?#how-it-works) which is how services will be exposed publically on the internet.

# üíª Hardware

The hardware for my homelab will probably evolve over time and will also probably vary from the setups that others reading this guide have. The aim of this section is to show how I have setup my homelab and document high-level details of each group of hardware that will probably be configured in the same way.

As an example if your homelab consists of a Raspberry PI and a different server such as a Dell Poweredge T30, the setups will be quite different. The Raspberry PI uses the ARM ISA, while the Dell Poweredge T30 uses the x86 ISA. Each of these will probably run a different OS with Raspberry PI using raspbian and Dell Poweredge T30 running Ubuntu 24.04. When grouping hardware together I will mainly be lumping these based on two parameters:

- **ISA (Instruction Set Architecture)** - Typically ARM or x86
- **OS (Operating System)** - Aiming to just run the same Ubuntu version on each server, but sometimes this doesn't work out.

Here is some brief info about the pieces of hardware I am using and how they fit into my homelab:

## Turing Pi

The foundation of my homelab will the [Turing PI 2.5.1](https://turingpi.com/product/turing-pi-2-5/) cluster board with 4 [Turing RK1 32GB](https://turingpi.com/product/turing-rk1/?attribute_ram=32+GB) cluster boards. These boards are ARM chips which are great for low power usage, and have an impressive amount of compute with 8 Cores - 32GB RAM - 6 TOPS NPU each.

> To put into perspective how much compute this is, if I were to purchase this on [fly.io](https://fly.io/docs/about/pricing/#started-fly-machines) it would cost:
>
> ```math
> 4 \times (\text{performance-8x 32Gb @ \$328.04/month}) = \$1,312.16/\text{month} = \$15,745.92/\text{year}
> ```
>
> or on [AWS](https://aws.amazon.com/ec2/pricing/on-demand/) it would cost:
>
> ```math
> 4 \times (\text{m6g.2xlarge 32Gb @ \$225.08/month}) = \$900.32/\text{month} = \$10,803.84/\text{year}
> ```

See more info about my [Turing PI RK1](./02.hardware.turing_pi_rk1.md) setup.

# üìÄ Software

The software this section will be describing are the software systems used in this homelab. There are a few pieces that will be used at a top-level:

- **Ansible** To provision servers and manage all servers on the homelab.
- **Helm** To provision the setup of the Kubernetes server and the services used on it.
- **Kubernetes** To host all applications, both containerized and VM-based.

## Ansible

This project will use Ansible to provision and manage all servers on the homelab. The best way to understand what Ansible is used for is just giving some examples of the things it automates:

- Add a public ssh key to the `~/.ssh/authorized_keys` file. This allows my macbook (which has the private key from the keypair) to ssh into the servers.
- Configure the `/etc/ssh/sshd_config` to `PasswordAuthentication no` so only remote access with a preconfigured ssh key is possible.
- Install Kuberenetes
- Set IPv4 packet forwarding for Kubernetes (`sysctl net.ipv4.ip_forward`)
- And many more configurations for the servers

Without Ansible I would need to log into every server and apply these rules. I would also need to write down all of the varying steps for each of the different types of servers in the cluster. For example, I can have an Ansible playbook which performs a set of actions only if the server is an `arm64` machine running Ubuntu 24.04. If I also have a Raspberry PI in my cluster, I can provision this differently as it will probably be running a different OS and need a slightly different set of configuration commands.

Ansible environments have three main components:

- **Control node** - A system on which Ansible is installed. You run Ansible commands such as `ansible` or `ansible-inventory` on a control node.
- **Inventory** - A list of managed nodes that are logically organized. You create an inventory on the control node to describe host deployments to Ansible.
- **Managed node** - A remote system, or host, that Ansible controls.

Ansible works by pushing commands from a control node to the managed nodes over an SSH connection, it does not require any software to be installed or running on the worker nodes.

![Ansible Diagram](./files/01.homelab.md/ansible_diagram.light.svg#gh-light-mode-only)
![Ansible Diagram](./files/01.homelab.md/ansible_diagram.dark.svg#gh-dark-mode-only)

## TODO: Helm

Talk about how Helm is used to configure Kubernetes predictably, also possibly explain how Kustomization is used (if needed) to configure Kubernetes itself.

## TODO: Kubernetes

Talk about how Kubernetes is used to run all applications/services on the network. This will not all fit here.

# üï∏Ô∏è TODO: Network

Fill in the information about using Cloudflare Tunnels to setup a local network. Explain how this mitigates issues such as not having a static ip address, and issues where users behind CGNAT can't even configure a DDNS service due to the limitations of CGNAT.
